(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{378:function(t,a,e){"use strict";e.r(a);var s=e(45),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"setup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup"}},[t._v("#")]),t._v(" Setup")]),t._v(" "),e("p",[t._v("We've already mentioned that "),e("code",[t._v("D4S")]),t._v(" is powered by "),e("code",[t._v("Izumi")]),t._v(". In fact, "),e("code",[t._v("D4S")]),t._v(" is the first library in Izumi's ecosystem, thus "),e("code",[t._v("D4S")]),t._v(" heavily relies on it.\nFurther, we'll talk about Izumi's components that allow "),e("code",[t._v("D4S")]),t._v(" to archive excellence.")]),t._v(" "),e("p",[t._v("Now, let's talk about the preparation stuff we need to do. There are many ways to handle dependencies, but generally, they fall in either of the two categories:\nwith DI or without DI. "),e("code",[t._v("PlayQ")]),t._v("'s team recommends using Izumi's DIStage as a dependency injection framework that handles all dependencies for you and even more.\nSince D4S intended to use within Izumi's ecosystem we will explain how to use DIStage to manage your dependencies. Anyway, it could be used without DI framework,\nbut this setup we will try to describe in observable future.")]),t._v(" "),e("h2",{attrs:{id:"managing-dependencies-with-distage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#managing-dependencies-with-distage"}},[t._v("#")]),t._v(" Managing dependencies with DIStage ðŸš€")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://izumi.7mind.io/distage",target:"_blank",rel:"noopener noreferrer"}},[t._v("DIStage"),e("OutboundLink")],1),t._v(" allows you to manage dependencies with ease, so you can reduce\nboilerplate code that is needed to construct objects in a program and spend more time developing crucial things.\nWith DIStage your will embrace a "),e("a",{attrs:{href:"https://izumi.7mind.io/latest/release/doc/distage/distage-framework.html#roles",target:"_blank",rel:"noopener noreferrer"}},[t._v("role-based"),e("OutboundLink")],1),t._v(" approach to structure an application\nwhich simplifies deployments. In case those words do not mean anything to you, don't worry, we will gently guide you\nand teach you everything you need to know. So, to start with DIStage we need to describe a role (could be many), create a plugin with our dependencies. Let's describe a role first.")]),t._v(" "),e("div",{staticClass:"language-scala extra-class"},[e("pre",{pre:!0,attrs:{class:"language-scala"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" TestRole"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("F"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("_"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("_"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" RoleService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("F"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Throwable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" start"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("roleParameters"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" RawEntrypointParams"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" freeArgs"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Vector"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DIResource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DIResourceBase"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("F"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Throwable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Unit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// define your logic here...")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" MainProd "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" MainBase"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Activation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CustomAxis "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" CustomAxis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Prod"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" MainDummy "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" MainBase"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Activation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CustomAxis "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" CustomAxis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Dummy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" TestRole "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" RoleDescriptor "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" id "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-role"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Basically, to define a role we need to extend "),e("code",[t._v("RoleService")]),t._v(" and describe desired logic inside "),e("code",[t._v("start")]),t._v(" method. Also, we need to define "),e("code",[t._v("RoleDescriptor")]),t._v(" which is used by DIStage to find a role.\nThe interesting thing here is that we use "),e("code",[t._v("DIResource")]),t._v(" that safely acquire/release resources. You can also spot we use "),e("a",{attrs:{href:"https://izumi.7mind.io/latest/release/doc/distage/basics.html#activation-axis",target:"_blank",rel:"noopener noreferrer"}},[t._v("activation axis"),e("OutboundLink")],1),t._v(" from DIStage.\nWe need such an axis to switch between different environments easily, in our case between the dummy and prod implementation of repo layer. The full code for role definition with activation axis you could find in our\nexample project here "),e("a",{attrs:{href:"https://github.com/VladPodilnyk/d4s-example/blob/8b74f576b9a4f9eeff0ac86dc99b2f3b3fbaa636/src/main/scala/leaderboard/LadderServiceRole.scala",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("p",[t._v("Okay, now we need to define a plugin. Fortunately, D4S provides a DIStage module that you can use in your project.")]),t._v(" "),e("div",{staticClass:"language-scala extra-class"},[e("pre",{pre:!0,attrs:{class:"language-scala"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" LeaderboardPlugin "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" PluginDef "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  include"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("AwsTagsModule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  include"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D4SModule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[e("code",[t._v("D4SModule")]),t._v(" creates everything you need to work with D4S even health check. We also add "),e("code",[t._v("AwsTagsModule")]),t._v(" that could be quite\nhelpful in case we want to tag our AWS tables.")]),t._v(" "),e("p",[t._v("Finally, you have to add a plugin for effect type that will be used to interpret blueprints. Here is how plugin with ZIO could look like:")]),t._v(" "),e("div",{staticClass:"language-scala extra-class"},[e("pre",{pre:!0,attrs:{class:"language-scala"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" ZIOPlugin "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" PluginDef "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  include"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ZIODIEffectModule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  addImplicit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Bracket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Task"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Throwable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  addImplicit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Task"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  addImplicit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ContextShiftThrowable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  addImplicit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AsyncThrowable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  addImplicit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ContextShift"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Task"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  make"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("TTimer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TTimer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  make"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ConcurrentThrowable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implicit")]),t._v(" r"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Runtime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Any")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n      implicitly"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ConcurrentEffect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Throwable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  make"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Blocker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    pool"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ThreadPoolExecutor "),e("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zio.io"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n      Blocker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("liftExecutionContext"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ExecutionContext"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fromExecutorService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pool"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  make"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("LogIO2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LogIO2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fromLogger"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" _"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Huurraayyy, we've finished setting up our project, now we are ready to move further. Before we move to the next session,\nwe would like to list what we achieved so far:")]),t._v(" "),e("ul",[e("li",[t._v("our app safely acquire/release resources")]),t._v(" "),e("li",[t._v("we have a healthcheck for our DynamoDB")]),t._v(" "),e("li",[t._v("we don't need to manually create tables (that is handled by D4S).")])])])}),[],!1,null,null,null);a.default=n.exports}}]);